# SICP综述
本书叙述了计算机程序的组成及其解释，作者基于一门简单而强有力的Lisp衍生语言Scheme来实现各种计算机编程的方法与思想，如通过过程抽象实现算法思想的一般化表示，通过数据抽象实现通用操作与可扩展的编程模块，引入赋值实现面向对象操作与流操作，然后用计算机编程的方法解释Scheme语言本身的实现以及基于计算机体系的设计程序。

## Lisp语言与过程的抽象

一门语言有三个关键要素：基本元素，组合方法与抽象方法。Scheme的基本元素包括基本数据（数字，字符串）与基本过程（加减乘除等计算），组合方法即是Lisp的括号，通过代换模型实现求值/应用流程，而抽象方法是define语句。这里的代换模型使用了求值/应用流程，所以其过程调用自动允许递归过程，而编译器优化允许将尾递归实现为常数空间的迭代过程。

数学上的很多计算都有固定的流程。n项的求和不需要某个特定的函数，我们只说它是 $f(n)$ 的几项相加。完全可以把函数 $f$ 作为参数传入求和的过程。进一步，我们可以用lambda表达式将过程变为一个独立的事物传入参数，同时还能将过程作为结果返回。其强大之处在于过程并不需要重新定义便能使用，更"高级"的过程以过程为自己的操作对象，表示一个更广泛的意义。

## 数据抽象

即使过程抽象很强大，能操作的对象也仅限数字与处理数字的过程。比如一个有理数包含分子与分母两个数字，而若到处带着这两个数字跑就会非常混乱，不得不时刻考虑这两个数字的意义，甚至与我们的程序目的——如计算有理数加法——毫无关系。于是我们需要从两个数字"建立"出有理数的方法，其分子与分母分别是这两个数字。因此我们引入了"序对"及其构造过程与取值过程，作为最基本的数据结构。

序对本身可以用任意方法实现，只要保证构造过程与取值过程能得到所要的结果。序列的元素可以同样是序对，这引出了任意长度的"表"结构，其根源是Scheme强大的"粘合剂"使得结构具有闭包的性质，在此之上构建的语言自动拥有了这一自由度，同样可以简单构建集合与树等更复杂的数据结构。处理复杂结构的核心思想是构造出抽象层以减少修改。

另一个提高抽象度的方法是使用符号。提及"加"的概念，则不只是数字加数字，还可以是向量加向量，多项式加多项式，矩阵加矩阵。我们于是用一个引号扩起的"加"来表示它。比如一个代数式出现了'+'，我就会认为它是一个做加法的式子，从而使用自定义的加法过程，这其实定义了多项式数据的加法运算。

符号可以用来构建类型系统。比如复数有直角坐标表示与极坐标表示，而使两者共同存在的方法是在不同表示的数据前加上其各自的符号，让更通用的过程凭符号选择过程调用。但这一做法的缺陷是不同表示必须要修改其过程名不冲突，而且新加入的表示必须要对系统进行修改。因而产生了数据导向的通用过程设计：不同数据的过程放在一个二维表格里，通用过程与数据各持有一个符号，而通用过程对符号操作时使用两符号为坐标对应的过程，类似C++虚函数表，但这个表是单独分出的。还可以不让过程选择操作而是数据选择操作，数据收到过程的符号时选用它的对应过程，此即消息传递的通用过程设计。

数据导向的可加性在构建复杂系统尤为强力。更高层的操作只需往数据前添上一个作类型标签的符号，这使得有理数、复数、整数等各种类型可以相互嵌套。在多项式等数据加入通用操作后，甚至可以嵌套出有理函数、复变函数，等等。不过类型嵌套有其难处：不同类数据的直接操作必须要定义，这可以在类型塔上使用强制类型转换；不过对更复杂的类型，还需要进一步讨论。

## 改变、对象、状态

之前的内容不含任何赋值，只有数据与过程的构造与求值。不使用赋值的编程称为函数式编程——给过程以一个输入，总对应其唯一输出。不过更强力的描绘复杂系统的方法不止于此——我们可以把系统看作相互作用与影响的对象。银行账户是一个对象，它有一个状态：余额。银行账户由于存钱或取钱会使得余额发生改变，我们也只需要看银行账户的余额而非存钱取钱的历史。随机数生成器也是一个对象，每次都返回某个范围的随机数字而不需要输入。引入赋值，过程就记住了它的行为，就能更好地将对象模块化。

然而，引入赋值的代价是不能再使用代换模型。同一个名字、表达式不可能总是用一个不变数据或过程为值，一旦赋值而变动状态就会有问题。我们开始将一个名字关联到一个存储地址，在那个地址存放了数据或过程，且可以被改变。过程求值将得到过程体与变量值环境指针的对偶，而应用过程就是构造存储了形式参数与实际参数的捆绑的环境，它是对偶的环境的子环境，过程放在其中求值——环境模型。环境模型正确地解释了赋值与作用域的原理。

使用赋值，我们能提高语言的抽象能力，建构出更多数据结构，如队列和表格。我们还能依靠消息传递的通用设计实现威力更强的对象。